---
title: "Exploring the BRFSS data"
output: 
  html_document: 
    fig_height: 4
    highlight: pygments
    theme: spacelab
---

## Setup

### Load packages

```{r load-packages, message = FALSE}
library(ggplot2)
library(dplyr)
```

### Load data

Make sure your data and R Markdown files are in the same directory. When loaded
your data file will be called `brfss2013`. Delete this note when before you submit 
your work. 

```{r load-data}
load("brfss2013.RData")
```



* * *

## Part 1: Data

### Background

BRFSS is an ongoing surveillance system designed to measure behavioral risk factors for the non-institutionalized adult population (18 years of age and older) residing in the US.<br>

BRFSS conducts both landline telephone- and cellular telephone-based surveys. In conducting the BRFSS landline
telephone survey, interviewers collect data from a randomly selected adult in a household. In conducting the
cellular telephone version of the BRFSS questionnaire, interviewers collect data from an adult who participates
by using a cellular telephone and resides in a private residence or college housing.

### Sample Description

In a telephone survey such as the BRFSS, a sample record is one telephone number in the list of all telephone
numbers the system randomly selects for dialing. To meet the BRFSS standard for the participating states'
sample designs, one must be able to justify sample records as a probability sample of all households with
telephones in the state. All participating areas met this criterion in 2013. Fifty-one projects used a
disproportionate stratified sample (DSS) design for their landline samples. Guam and Puerto Rico used a simple
random-sample design. <br>

In the type of DSS design that states most commonly used in the BRFSS landline telephone sampling, BRFSS
divides telephone numbers into two groups, or strata, which are sampled separately. The high-density and
medium-density strata contain telephone numbers that are expected to belong mostly to households. Whether a
telephone number goes into the high-density or medium-density stratum is determined by the number of listed
household numbers in its hundred block, or set of 100 telephone numbers with the same area code, prefix, and
first two digits of the suffix and all possible combinations of the last two digits. BRFSS puts numbers from
hundred blocks with one or more listed household numbers (“1+ blocks,” or “banks”) in either the high-density
stratum (“listed 1+ blocks”) or medium-density stratum (“unlisted 1 + blocks”). BRFSS samples the two strata
to obtain a probability sample of all households with telephones.<br>

Cellular telephone sampling frames are commercially available and the system can call random samples of
cellular telephone numbers, but doing so requires specific protocols. The basis of the 2013 BRFSS sampling
frame is the Telecordia database of telephone exchanges (e.g., 617-492-0000 to 617-492-9999) and 1,000 banks
(e.g., 617-492-0000 to 617-492-0999). The vendor uses dedicated cellular 1,000 banks, sorted on the basis of
area code and exchange within a state. BRFSS forms an interval, K, by dividing the population count of
telephone numbers in the frame, N, by the desired sample size, n. BRFSS divides the frame of telephone
numbers into n intervals of size K telephone numbers. From each interval, BRFSS draws one 10-digit telephone
number at random.<br>

The target population for cellular telephone samples in 2013 consists of persons residing in a private residence
or college housing, who have a working cellular telephone, are aged 18 and older, and received 90 percent or
more of their calls on cellular telephones.<br>

In the sample design, each state begins with a single stratum. To provide adequate sample sizes for smaller
geographically defined populations of interest, however, many states sample disproportionately from strata that
correspond to sub-state regions. In 2013, the 48 states or territories with disproportionately sampled geographic
strata were Alabama, Alaska, Arizona, Arkansas, California, Colorado, Connecticut, Delaware, Florida,
Georgia, Hawaii, Idaho, Illinois, Indiana, Iowa, Kansas, Kentucky, Louisiana, Maine, Maryland, Massachusetts, 
Michigan, Minnesota, Mississippi, Missouri, Montana, Nebraska, Nevada, New Hampshire, New Jersey, New
Mexico, New York, North Carolina, Ohio, Oklahoma, Pennsylvania, Puerto Rico, Rhode Island, South
Carolina, South Dakota, Tennessee, Texas, Utah, Vermont, Virginia, the US Virgin Islands, Washington, and
Wisconsin. As a precaution to protect the confidential responses provided by the respondent, specific variables
(such as sub-state geographic identifiers, detailed race/ethnicity, and age greater than 80) in a given year are
removed.<br>

State health departments may directly collect data from their states or they may use a contractor. In 2013, 11
state health departments collected their data in-house; 42 contracted data collection to university survey
research centers or commercial firms. In 2013, the CDC provided samples purchased from Marketing Systems
Group, Inc. (MSG) to all 53 states and territories. <br>

Overall, the data collection is based on a stratified sampling strategy.
The population is divided into groups (States) called strata. Then a random sampling (telephone), has been employed within
each stratum.

### Data Collection Procedure

In 2013, 53 states or territories used Computer-Assisted Telephone Interview (CATI) systems. The CDC
supports CATI programming using the Ci3 WinCATI software package. This support includes programming
the core and module questions for data collectors, providing questionnaire scripting of state-added questions for
states requiring such assistance, and contracting with a Ci3 consultant to assist states. Following guidelines
provided by the BRFSS, state health personnel or contractors conduct interviews. The core portion of the
questionnaire lasts an average of 18 minutes. Interview time for modules and state-added questions is dependent
upon the number of questions used, but generally, they add 5 to 10 minutes to the interview.
Interviewer retention is very high among states that conduct the survey in-house. The state coordinator or
interviewer supervisor conduct repeated training specific to the BRFSS. Contractors typically use interviewers
who have experience conducting telephone surveys, but these interviewers are given additional training on the
BRFSS questionnaire and procedures before they are approved to work on BRFSS.
BRFSS protocols require evaluation of interviewer performance. In 2013, all BRFSS surveillance sites had the
capability to monitor their interviewers. Interviewer-monitoring systems vary from listening to the interviewer
only at an on-site location to listening to both the interviewer and respondent at remote locations. Some states
also use verification callbacks in addition to direct monitoring. Contractors typically conducted systematic
monitoring of each interviewer a certain amount of time each month. All states had the capability to tabulate
disposition code frequencies by interviewer. These data were the primary means for quantifying interviewer
performance. 
States conducted telephone interviews during each calendar month; they made calls seven days per week,
during both daytime and evening hours. They followed standard BRFSS procedures for rotation of calls over
days of the week and time of day.


Source: [CDC.gov](https://www.cdc.gov/brfss/annual_data/annual_2013.html)


* * *

## Part 2: Research questions

I’ll focus on a health problem - sleep, work-out and smoking.

**Research quesion 1:**
Does sleep affects mental health and your energery?
<ul>
    <li>qlhlth2: How many days full of energy in past 30 days?</li>
    <li>sleptim1: How Much Time Do You Sleep ?</li>
    <li>menthlth: Number of Days Mental Health Not Good</li>
</ul>
**Research quesion 2:**
Are people who working out catch physical illness regularly ?
<ul>
<li>physhlth: Now thinking about your physical health, which includes physical illness and injury, for how many days during the
past 30 days was your physical health not good? </li>
<li>strength: How many times did you do physical activities or exercises to STRENGTHEN your muscles?</li>
<li>X_totinda: Adults who reported doing physical activity or exercise during the past 30 days other than their regular job</li>
</ul>
**Research quesion 3:**
Is there a correlation between education level and tobacco use? 
<ul>
<li>educa: Education Level</li>
<li>smoke100: Smoked At Least 100 Cigarettes</li>
<li>smokday2: Frequency Of Days Now Smoking</li>
</ul>

* * *
## Part 3: Exploratory data analysis

**Research quesion 1:**

*** Does sleep affects mental health and your energery?***

Filter NaN value

```{r}
filteredData = brfss2013[!rowSums(is.na(brfss2013[c('qlhlth2','sleptim1', 'menthlth' )])), ]

nrow(filteredData)
```

Comparing to number of observations in data, our interest data might be a bit smaller. But I think it would be sufficient for our analysis


Change them to categorical values

```{r}
filteredData <- filteredData %>%
  mutate(isEnoughSleep = ifelse(sleptim1 >= 7 & sleptim1 <= 9 ,"Adequate", "Inappropriate"))

filteredData <- filteredData %>%
  mutate(isHappy = ifelse(menthlth >= 10,"Bad Mood", "Good Mood"))

filteredData <- filteredData %>%
  mutate(isActive = ifelse(qlhlth2 >= 20,"High", "Low"))

```


Visualise data

```{r}
filteredData$isEnoughSleep <- as.factor(filteredData$isEnoughSleep)
filteredData$isHappy <- as.factor(filteredData$isHappy)
filteredData$isActive <- as.factor(filteredData$isActive)
ggplot(filteredData, aes(x=isEnoughSleep, fill = isActive)) +
  geom_bar(position="dodge") + facet_wrap( ~ isHappy, ncol=2) +
  ggtitle('Does sleep affects mental health and your energery?')+
  scale_fill_discrete(name = "Energy Level")+
  xlab("Sleep Time") + ylab("Number of people")
```

As is evident from the graph, sleep might make you perky when you spend an appropriate time

But it is not have a strongly effect on people has a mental health problems.

Let's look closely at percentages between them.

```{r}
filteredData %>%
  group_by(isActive) %>%
  summarise(per = sum(isEnoughSleep == "Adequate") / nrow(filteredData))

```

```{r}
filteredData %>%
  group_by(isHappy) %>%
  summarise(per = sum(isEnoughSleep == "Adequate") / nrow(filteredData))

```

As excepted, sleep might be promote both better mental and physical health. 
We cannot conclude causality relation due to observational data.

**Research quesion 2:**

*** Are people who working out catch physical illness regularly ?***

Clean data first

```{r}
filteredData = brfss2013[!rowSums(is.na(brfss2013[c('X_totinda','strength','physhlth')])), ]
```

Transform data, so that they represent how many time per day did people spend to working out.

```{r}
filteredData$strength[(filteredData$strength>= 101) & (filteredData$strength <=199)] =
  (filteredData$strength[(filteredData$strength>= 101) & (filteredData$strength <=199)]) - 100

filteredData$strength[(filteredData$strength>= 201) & (filteredData$strength <=299)] =
  (filteredData$strength[(filteredData$strength>= 201) & (filteredData$strength <=299)] - 200) / 7

filteredData$strength[(filteredData$strength>= 300)] =
  (filteredData$strength[(filteredData$strength>= 300)] - 300) /30

filteredData$strength[filteredData$strength>=10] = 10


filteredData = filteredData[!rowSums(is.na(filteredData[c('X_totinda','strength')])), ]

```

Visualise data

```{r}
filteredData$X_totinda <- as.factor(filteredData$X_totinda)
filteredData$physhlth <- as.factor(filteredData$physhlth)

summary(filteredData$physhlth)

ggplot(filteredData, aes(x = strength, y = physhlth, colour=X_totinda)) +
  geom_point(alpha=0.4, position=position_jitter(width=.1,height=.1))+
  facet_wrap( ~ X_totinda, ncol=1)

```

I tried so hard to make the plots not over plotting but them appeared overlayed. It is not easy to figure out the different between them due to its similarity. I believe that this obersevational data prevent us to see through the trends in graphs.

**Research quesion 3:**

*** Is there a correlation between education level and tobacco use? ***

**** Which education level did people smoke the most?****

Make data clean first

```{r}
filteredData = brfss2013[!rowSums(is.na(brfss2013[c('educa', 'smoke100')])), ]
```

Create lables for our plot
```{r}
edu_lables = c("KG", "EL", "HG", "HG_GRD", "COL/TECH/3", "COL/4")
```

Seperate our interest data from whole data

```{r}
filteredData <- filteredData %>% group_by(educa) %>%
  summarise( smoke100 = sum(smoke100 == "Yes"), smoke100_pc = smoke100*100/n())
```

Visualise data

```{r}
ggplot(data = filteredData , aes(x = educa, y = smoke100_pc)) + 
  geom_col() +
  scale_x_discrete(labels = edu_lables) +
  ylab("% who've smoked 100 cigs") +
  xlab("Education Level") +
  scale_y_continuous(labels = function(x) paste0(x,"%"))

```

People who've been to high school but not graduated smoke the most (~60%).<br> 
  People who've only been to Kindergarten or graduated college smoke the least (~35%). <br>
  There is an increase from kindergarten to high school, and then a drop till college graduate.
  
**** How many times per day did they smoke?****

```{r}

filteredData = brfss2013[!rowSums(is.na(brfss2013[c('educa', 'smoke100')])), ]

summary(filteredData$smokday2)


filteredData = brfss2013[!rowSums(is.na(brfss2013[c('educa', 'smoke100','smokday2')])), ]

summary(filteredData$smokday2)


```

Something's odd with the data we are using <br>
Maybe people who have smoked 100 cigs did not answer the smokday2 question <br>
Let's find out!

```{r}
sfrq <- brfss2013 %>%
  filter(!((is.na(educa) & is.na(smoke100)))) %>%
  select(educa, smokday2)

sum(is.na(filteredData$smokday2))*100 / nrow(sfrq)
rm(sfrq)
```
No person who has smoked 100 cigs did answer the smokday2 question <br>
So we will only focus on people who have smoked at least 100 cigs<br>

Clean data for processing

```{r}
filteredData = brfss2013[!rowSums(is.na(brfss2013[c('educa', 'smokday2')])), ]
```

Visualise data

```{r}
filteredData$educa <- as.factor(filteredData$educa)
filteredData$smokday2 <- as.factor(filteredData$smokday2)
ggplot(filteredData, aes(x=educa, fill = smokday2)) +
  geom_bar()+
  scale_fill_discrete(name = "Frequency of smoking")+
  scale_x_discrete(labels = edu_lables)+
  xlab("Education Level") + ylab("Number of people")

```

High school but not graduated has the highest proportion of people who smoke daily<br>
 Proportion of daily smokers soared from kindergarten to high school, and then dwindled.
