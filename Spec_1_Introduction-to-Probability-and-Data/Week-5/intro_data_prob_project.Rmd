---
title: "Exploring the BRFSS data"
output: 
  html_document: 
    fig_height: 4
    highlight: pygments
    theme: spacelab
---

## Setup

### Load packages

```{r load-packages, message = FALSE}
library(ggplot2)
library(dplyr)
```

### Load data

```{r load-data}
load("brfss2013.RData")
```



* * *

## Part 1: Data

### Overview

Entire sample is subject to non-response bias
<br>
The collected data came from people who were willing to answer on the phone and finish whole or some part of the long survey.
<br>

### Sampling Design

In order to conduct the BRFSS, states obtain samples of telephone numbers from CDC. The BRFSS uses two samples 
<br>
<br>
<ul>
<li><b>The Landline Sample</b><br>
<p>
Used DSS - Disproportionate stratified sampling since 2003. They drew telephone numbers from two strata that were based on the hypothesis in the density of known telephone household numbers. In that design, telephone numbers were classified into 2 kinds of stratum that either had a high density or average one to yield residential telephone numbers for surveying.
</p>
</li>
<li><b>The Cellular Telephone Sample</b><br>
<p>
Randomly generated from a "sampling frame" of validated cellular area code with prefix combinations having equal probability. 
</p>
</li>
</ul>
### Scope of Inference

It is obvious that the BRFSS survey is actually an observational retrosepctive study that used a "stratified sampling design" based on "random digit dialing methods" to select a representative sample from each state's non-institutionalized residents.
<br>
<br>
In that sample design, each state began with a single stratum to provide adequate sample sizes for smaller geographically defined populations of interest but many states sample were disproportionate in their strata that correspond to sub-state regions.
<br>
<br>

#### Generalizability

The dataset could be generalizable to all non-institutionalized adults (18 years of age and older) residing in the U.S.
<br>
<br>

#### Causality

From my above writing, making causal conclusions based on observational data is not recommended. Observational studies are only sufficient to show correlations.
<br>
<br>

### Summary
The data collection is based on a stratified sampling strategy. The population is divided into groups (States) called strata. Then a random sampling (telephone), has been employed within each stratum.It can be generalized to the US population


* * *

<b>The data and further information were used in this project from the following sources:</b>

General Information: [2013 Survey Data Information](http://www.cdc.gov/brfss/annual_data/annual_2013.html) 

<ul>
<li>[2013 BRFSS Overview](http://www.cdc.gov/brfss/annual_data/2013/pdf/overview_2013.pdf) [PDF - 84 KB]<br> 
       Encapsulate all information like the BRFSS 's background, design, data collection and processing, etc.<br><br>
<li>[2013 BRFSS Codebook](http://www.cdc.gov/brfss/annual_data/2013/pdf/codebook13_llcp.pdf) [PDF - 2.7 MB]<br>
       Codebook showing data and notes in the dataset.<br><br>
</ul>


* * *

## Part 2: Research questions

Iâ€™ll focus on a health problem - sleep, work-out and smoking.

**Research quesion 1:**
Does sleep have any relationship between mental health and energery?
<ul>
    <li>qlhlth2: How many days full of energy in past 30 days?</li>
    <li>sleptim1: How Much Time Do You Sleep ?</li>
    <li>menthlth: Number of Days Mental Health Not Good</li>
</ul>
**Research quesion 2:**
Are the frequency of working out associated to your physical health?
<ul>
<li>physhlth: Now thinking about your physical health, which includes physical illness and injury, for how many days during the
past 30 days was your physical health not good? </li>
<li>strength: How many times did you do physical activities or exercises to STRENGTHEN your muscles?</li>
<li>X_totinda: Adults who reported doing physical activity or exercise during the past 30 days other than their regular job</li>
</ul>
**Research quesion 3:**
Is there a correlation between education level and tobacco use? 
<ul>
<li>educa: Education Level</li>
<li>smoke100: Smoked At Least 100 Cigarettes</li>
<li>smokday2: Frequency Of Days Now Smoking</li>
</ul>

* * *
## Part 3: Exploratory data analysis

**Research quesion 1:**

***Does sleep have any relationship between mental health and energery?***

Filter NaN value

```{r}
filteredData = brfss2013[!rowSums(is.na(brfss2013[c('qlhlth2','sleptim1', 'menthlth' )])), ]

nrow(filteredData)
```

Comparing to number of observations in data, our interest data might be a bit smaller. But I think it would be sufficient for our analysis


Change them to categorical values

```{r}
filteredData <- filteredData %>%
  mutate(isEnoughSleep = ifelse(sleptim1 >= 7 & sleptim1 <= 9 ,"Adequate", "Inappropriate"))

filteredData <- filteredData %>%
  mutate(isHappy = ifelse(menthlth >= 10,"Bad Mood", "Good Mood"))

filteredData <- filteredData %>%
  mutate(isActive = ifelse(qlhlth2 >= 20,"High", "Low"))

```


Visualise data

```{r}
filteredData$isEnoughSleep <- as.factor(filteredData$isEnoughSleep)
filteredData$isHappy <- as.factor(filteredData$isHappy)
filteredData$isActive <- as.factor(filteredData$isActive)
ggplot(filteredData, aes(x=isEnoughSleep, fill = isActive)) +
  geom_bar(position="dodge") + facet_wrap( ~ isHappy, ncol=2) +
  ggtitle('Does sleep affects mental health and your energery?')+
  scale_fill_discrete(name = "Energy Level")+
  xlab("Sleep Time") + ylab("Number of people")
```

As is evident from the graph, sleep might make you perky when you spend an appropriate time

But it is not have a strongly effect on people has a mental health problems.

Let's look closely at percentages between them.

```{r}
filteredData %>%
  group_by(isActive) %>%
  summarise(per = sum(isEnoughSleep == "Adequate") / nrow(filteredData))

```

```{r}
filteredData %>%
  group_by(isHappy) %>%
  summarise(per = sum(isEnoughSleep == "Adequate") / nrow(filteredData))

```

As excepted, sleep might be promote both better mental and physical health. 
We cannot conclude causality relation due to observational data.

**Research quesion 2:**

***Are the frequency of working out associated to your physical health?***

Clean data first

```{r}
filteredData = brfss2013[!rowSums(is.na(brfss2013[c('X_totinda','strength','physhlth')])), ]
```

Transform data, so that they represent how many time per day did people spend to working out.

```{r}
filteredData$strength[(filteredData$strength>= 101) & (filteredData$strength <=199)] =
  (filteredData$strength[(filteredData$strength>= 101) & (filteredData$strength <=199)]) - 100

filteredData$strength[(filteredData$strength>= 201) & (filteredData$strength <=299)] =
  (filteredData$strength[(filteredData$strength>= 201) & (filteredData$strength <=299)] - 200) / 7

filteredData$strength[(filteredData$strength>= 300)] =
  (filteredData$strength[(filteredData$strength>= 300)] - 300) /30

filteredData$strength[filteredData$strength>=10] = 10


filteredData = filteredData[!rowSums(is.na(filteredData[c('X_totinda','strength')])), ]

```

Visualise data

```{r}
filteredData$X_totinda <- as.factor(filteredData$X_totinda)
filteredData$physhlth <- as.factor(filteredData$physhlth)

ggplot(filteredData, aes(x = strength, y = physhlth, colour=X_totinda)) +
  geom_point(alpha=0.4, position=position_jitter(width=.1,height=.1))+
  facet_wrap( ~ X_totinda, ncol=1)

```

I tried so hard to make the plots not over plotting but them appeared overlayed. It is not easy to figure out the different between them due to its similarity. I believe that this obersevational data prevent us to see through the trends in graphs. I will need to working on this problem through out this specialization.

**Research quesion 3:**

***Is there a correlation between education level and tobacco use? ***

***Which education level did people smoke the most?***

Make data clean first

```{r}
filteredData = brfss2013[!rowSums(is.na(brfss2013[c('educa', 'smoke100')])), ]
```

Create lables for our plot
```{r}
edu_lables = c("KG", "EL", "HG", "HG_GRD", "COL/TECH/3", "COL/4")
```

Seperate our interest data from whole data

```{r}
filteredData <- filteredData %>% group_by(educa) %>%
  summarise( smoke100 = sum(smoke100 == "Yes"), smoke100_pc = smoke100*100/n())
```

Visualise data

```{r}
ggplot(data = filteredData , aes(x = educa, y = smoke100_pc)) + 
  geom_col() +
  scale_x_discrete(labels = edu_lables) +
  ylab("% who've smoked 100 cigs") +
  xlab("Education Level") +
  scale_y_continuous(labels = function(x) paste0(x,"%"))

```

People who've been to high school but not graduated smoke the most (~60%).<br> 
  People who've only been to Kindergarten or graduated college smoke the least (~35%). <br>
  There is an increase from kindergarten to high school, and then a drop till college graduate.
  
***How many times per day did they smoke?***

```{r}

filteredData = brfss2013[!rowSums(is.na(brfss2013[c('educa', 'smoke100')])), ]

summary(filteredData$smokday2)


filteredData = brfss2013[!rowSums(is.na(brfss2013[c('educa', 'smoke100','smokday2')])), ]

summary(filteredData$smokday2)


```

Something's odd with the data we are using <br>
Maybe people who have smoked 100 cigs did not answer the smokday2 question <br>
Let's find out!

```{r}
temp <- brfss2013 %>%
  filter(!((is.na(educa) & is.na(smoke100)))) %>%
  select(educa, smokday2)

sum(is.na(filteredData$smokday2))*100 / nrow(temp)
rm(temp) #delete temp data
```
No person who has smoked 100 cigs did answer the smokday2 question <br>
So we will only focus on people who have smoked at least 100 cigs<br>

Clean data for processing

```{r}
filteredData = brfss2013[!rowSums(is.na(brfss2013[c('educa', 'smokday2')])), ]
```

Visualise data

```{r}
filteredData$educa <- as.factor(filteredData$educa)
filteredData$smokday2 <- as.factor(filteredData$smokday2)
ggplot(filteredData, aes(x=educa, fill = smokday2)) +
  geom_bar()+
  scale_fill_discrete(name = "Frequency of smoking")+
  scale_x_discrete(labels = edu_lables)+
  xlab("Education Level") + ylab("Number of people")

```

High school but not graduated has the highest proportion of people who smoke daily<br>
 Proportion of daily smokers soared from kindergarten to high school, and then dwindled.